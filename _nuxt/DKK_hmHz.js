import{a2 as I,r as E,K as k,v as C,O,a3 as R,p as D,a4 as U,f as B,P as L}from"#entry";function v(t){return typeof t=="string"?`'${t}'`:new P().serialize(t)}const P=(function(){class t{#e=new Map;compare(e,i){const o=typeof e,a=typeof i;return o==="string"&&a==="string"?e.localeCompare(i):o==="number"&&a==="number"?e-i:String.prototype.localeCompare.call(this.serialize(e,!0),this.serialize(i,!0))}serialize(e,i){if(e===null)return"null";switch(typeof e){case"string":return i?e:`'${e}'`;case"bigint":return`${e}n`;case"object":return this.$object(e);case"function":return this.$function(e)}return String(e)}serializeObject(e){const i=Object.prototype.toString.call(e);if(i!=="[object Object]")return this.serializeBuiltInType(i.length<10?`unknown:${i}`:i.slice(8,-1),e);const o=e.constructor,a=o===Object||o===void 0?"":o.name;if(a!==""&&globalThis[a]===o)return this.serializeBuiltInType(a,e);if(typeof e.toJSON=="function"){const n=e.toJSON();return a+(n!==null&&typeof n=="object"?this.$object(n):`(${this.serialize(n)})`)}return this.serializeObjectEntries(a,Object.entries(e))}serializeBuiltInType(e,i){const o=this["$"+e];if(o)return o.call(this,i);if(typeof i?.entries=="function")return this.serializeObjectEntries(e,i.entries());throw new Error(`Cannot serialize ${e}`)}serializeObjectEntries(e,i){const o=Array.from(i).sort((n,s)=>this.compare(n[0],s[0]));let a=`${e}{`;for(let n=0;n<o.length;n++){const[s,c]=o[n];a+=`${this.serialize(s,!0)}:${this.serialize(c)}`,n<o.length-1&&(a+=",")}return a+"}"}$object(e){let i=this.#e.get(e);return i===void 0&&(this.#e.set(e,`#${this.#e.size}`),i=this.serializeObject(e),this.#e.set(e,i)),i}$function(e){const i=Function.prototype.toString.call(e);return i.slice(-15)==="[native code] }"?`${e.name||""}()[native]`:`${e.name}(${e.length})${i.replace(/\s*\n\s*/g,"")}`}$Array(e){let i="[";for(let o=0;o<e.length;o++)i+=this.serialize(e[o]),o<e.length-1&&(i+=",");return i+"]"}$Date(e){try{return`Date(${e.toISOString()})`}catch{return"Date(null)"}}$ArrayBuffer(e){return`ArrayBuffer[${new Uint8Array(e).join(",")}]`}$Set(e){return`Set${this.$Array(Array.from(e).sort((i,o)=>this.compare(i,o)))}`}$Map(e){return this.serializeObjectEntries("Map",e.entries())}}for(const r of["Error","RegExp","URL"])t.prototype["$"+r]=function(e){return`${r}(${e})`};for(const r of["Int8Array","Uint8Array","Uint8ClampedArray","Int16Array","Uint16Array","Int32Array","Uint32Array","Float32Array","Float64Array"])t.prototype["$"+r]=function(e){return`${r}[${e.join(",")}]`};for(const r of["BigInt64Array","BigUint64Array"])t.prototype["$"+r]=function(e){return`${r}[${e.join("n,")}${e.length>0?"n":""}]`};return t})();function x(t,r){return t===r||v(t)===v(r)}function M(t,r){if(typeof t!="string")throw new TypeError("argument str must be a string");const e={},i=r||{},o=i.decode||N;let a=0;for(;a<t.length;){const n=t.indexOf("=",a);if(n===-1)break;let s=t.indexOf(";",a);if(s===-1)s=t.length;else if(s<n){a=t.lastIndexOf(";",n-1)+1;continue}const c=t.slice(a,n).trim();if(i?.filter&&!i?.filter(c)){a=s+1;continue}if(e[c]===void 0){let u=t.slice(n+1,s).trim();u.codePointAt(0)===34&&(u=u.slice(1,-1)),e[c]=F(u,o)}a=s+1}return e}function N(t){return t.includes("%")?decodeURIComponent(t):t}function F(t,r){try{return r(t)}catch{return t}}const g=/^[\u0009\u0020-\u007E\u0080-\u00FF]+$/;function A(t,r,e){const i=e||{},o=i.encode||encodeURIComponent;if(typeof o!="function")throw new TypeError("option encode is invalid");if(!g.test(t))throw new TypeError("argument name is invalid");const a=o(r);if(a&&!g.test(a))throw new TypeError("argument val is invalid");let n=t+"="+a;if(i.maxAge!==void 0&&i.maxAge!==null){const s=i.maxAge-0;if(Number.isNaN(s)||!Number.isFinite(s))throw new TypeError("option maxAge is invalid");n+="; Max-Age="+Math.floor(s)}if(i.domain){if(!g.test(i.domain))throw new TypeError("option domain is invalid");n+="; Domain="+i.domain}if(i.path){if(!g.test(i.path))throw new TypeError("option path is invalid");n+="; Path="+i.path}if(i.expires){if(!_(i.expires)||Number.isNaN(i.expires.valueOf()))throw new TypeError("option expires is invalid");n+="; Expires="+i.expires.toUTCString()}if(i.httpOnly&&(n+="; HttpOnly"),i.secure&&(n+="; Secure"),i.priority)switch(typeof i.priority=="string"?i.priority.toLowerCase():i.priority){case"low":{n+="; Priority=Low";break}case"medium":{n+="; Priority=Medium";break}case"high":{n+="; Priority=High";break}default:throw new TypeError("option priority is invalid")}if(i.sameSite)switch(typeof i.sameSite=="string"?i.sameSite.toLowerCase():i.sameSite){case!0:{n+="; SameSite=Strict";break}case"lax":{n+="; SameSite=Lax";break}case"strict":{n+="; SameSite=Strict";break}case"none":{n+="; SameSite=None";break}default:throw new TypeError("option sameSite is invalid")}return i.partitioned&&(n+="; Partitioned"),n}function _(t){return Object.prototype.toString.call(t)==="[object Date]"||t instanceof Date}function l(t){if(typeof t!="object")return t;var r,e,i=Object.prototype.toString.call(t);if(i==="[object Object]"){if(t.constructor!==Object&&typeof t.constructor=="function"){e=new t.constructor;for(r in t)t.hasOwnProperty(r)&&e[r]!==t[r]&&(e[r]=l(t[r]))}else{e={};for(r in t)r==="__proto__"?Object.defineProperty(e,r,{value:l(t[r]),configurable:!0,enumerable:!0,writable:!0}):e[r]=l(t[r])}return e}if(i==="[object Array]"){for(r=t.length,e=Array(r);r--;)e[r]=l(t[r]);return e}return i==="[object Set]"?(e=new Set,t.forEach(function(o){e.add(l(o))}),e):i==="[object Map]"?(e=new Map,t.forEach(function(o,a){e.set(l(a),l(o))}),e):i==="[object Date]"?new Date(+t):i==="[object RegExp]"?(e=new RegExp(t.source,t.flags),e.lastIndex=t.lastIndex,e):i==="[object DataView]"?new t.constructor(l(t.buffer)):i==="[object ArrayBuffer]"?t.slice(0):i.slice(-6)==="Array]"?new t.constructor(t):t}const H={path:"/",watch:!0,decode:t=>I(decodeURIComponent(t)),encode:t=>encodeURIComponent(typeof t=="string"?t:JSON.stringify(t))},m=globalThis.cookieStore;function b(t,r){const e={...H,...r};e.filter??=u=>u===t;const i=T(e)||{};let o;e.maxAge!==void 0?o=e.maxAge*1e3:e.expires&&(o=e.expires.getTime()-Date.now());const a=o!==void 0&&o<=0,n=a||i[t]===void 0||i[t]===null,s=l(a?void 0:i[t]??e.default?.()),c=o&&!a?q(s,o,e.watch&&e.watch!=="shallow"):E(s);{let u=null;try{!m&&typeof BroadcastChannel<"u"&&(u=new BroadcastChannel(`nuxt:cookies:${t}`))}catch{}const p=(f=!1)=>{!f&&(e.readonly||x(c.value,i[t]))||(V(t,c.value,e),i[t]=l(c.value),u?.postMessage({value:e.encode(c.value)}))},h=f=>{const d=f.refresh?T(e)?.[t]:e.decode(f.value);y=!0,c.value=d,i[t]=l(d),D(()=>{y=!1})};let y=!1;const $=!!O();if($&&k(()=>{y=!0,p(),u?.close()}),m){const f=d=>{const S=d.changed.find(w=>w.name===t),z=d.deleted.find(w=>w.name===t);S&&h({value:S.value}),z&&h({value:null})};m.addEventListener("change",f),$&&k(()=>m.removeEventListener("change",f))}else u&&(u.onmessage=({data:f})=>h(f));e.watch&&C(c,()=>{y||p()},{deep:e.watch!=="shallow"}),n&&p(n)}return c}function T(t={}){return M(document.cookie,t)}function J(t,r,e={}){return r==null?A(t,r,{...e,maxAge:-1}):A(t,r,e)}function V(t,r,e={}){document.cookie=J(t,r,e)}const j=2147483647;function q(t,r,e){let i,o,a=0;const n=e?E(t):{value:t};return O()&&k(()=>{o?.(),clearTimeout(i)}),R((s,c)=>{e&&(o=C(n,c));function u(){a=0,clearTimeout(i);const p=r-a,h=p<j?p:j;i=setTimeout(()=>{if(a+=h,a<r)return u();n.value=void 0,c()},h)}return{get(){return s(),n.value},set(p){u(),n.value=p,c()}}})}const X=U("auth",{state:()=>({authToken:b("authToken").value}),getters:{isLoggedIn:t=>!!t.authToken},actions:{setAuthToken(t){const r=b("authToken");this.authToken=t,r.value=t},async logout(){const{public:t}=B();try{this.authToken&&await fetch(`${t.apiBase}/logout`,{method:"POST",headers:{Authorization:`Bearer ${this.authToken}`,"Content-Type":"application/json",Accept:"application/json"}})}catch(r){console.error("Logout API failed (token may be expired):",r)}finally{this.authToken=null;const r=b("authToken");r.value=null,console.log("Logged out successfully. Redirecting..."),await L("/login")}}}});export{X as u};
